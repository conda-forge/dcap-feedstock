From e75df42b2952d19ee4f0d874fe18c23c8bfcdaa4 Mon Sep 17 00:00:00 2001
From: Chris Burr <christopher.burr@cern.ch>
Date: Sat, 22 Jan 2022 10:30:52 +0100
Subject: [PATCH 1/3] Recent macOS SDKs don't define *stat64 as it's identical
 to *stat

---
 configure.ac      | 7 +++++++
 src/string2stat.c | 2 ++
 2 files changed, 9 insertions(+)

diff --git a/configure.ac b/configure.ac
index ddfc8ba..2a59203 100644
--- a/configure.ac
+++ b/configure.ac
@@ -122,6 +122,13 @@ AC_TYPE_UID_T
 AC_C_BIGENDIAN
 AC_CHECK_TYPES([long long])
 
+AC_CHECK_DECL(stat64, AC_CHECK_FUNC(stat64))
+if test "$ac_cv_func_stat64" != yes; then
+    AC_DEFINE(fstat64, fstat, [64-bit operations are the same as 32-bit])
+    AC_DEFINE(lstat64, lstat, [64-bit operations are the same as 32-bit])
+    AC_DEFINE(stat64, stat, [64-bit operations are the same as 32-bit])
+fi
+
 
 dnl Store the compile flags prior to testing the presence.
 
diff --git a/src/string2stat.c b/src/string2stat.c
index 5572632..2045828 100644
--- a/src/string2stat.c
+++ b/src/string2stat.c
@@ -20,6 +20,8 @@
 #include <string.h>
 #include <sys/stat.h>
 
+#include "debug_level.h"
+
 #ifdef WIN32
 #	include "dcap_unix2win.h"
 #endif /* WIN32 */
-- 
2.29.2


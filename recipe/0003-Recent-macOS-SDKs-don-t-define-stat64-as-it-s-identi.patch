From 458f12d8e7d8b6f9053f816ae269dbf596b4a50e Mon Sep 17 00:00:00 2001
From: Chris Burr <christopher.burr@cern.ch>
Date: Sun, 23 Jan 2022 11:06:37 +0100
Subject: [PATCH 2/2] Check for _DARWIN_FEATURE_ONLY_64_BIT_INODE and define
 stat64/fstat64/lstat64 if needed

---
 configure.ac      | 6 ++++++
 src/string2stat.c | 2 ++
 2 files changed, 8 insertions(+)

diff --git a/configure.ac b/configure.ac
index ddfc8ba..90a0788 100644
--- a/configure.ac
+++ b/configure.ac
@@ -122,6 +122,12 @@ AC_TYPE_UID_T
 AC_C_BIGENDIAN
 AC_CHECK_TYPES([long long])
 
+AC_EGREP_HEADER(
+    [[_DARWIN_FEATURE_ONLY_64_BIT_INODE]],
+    [sys/cdefs.h],
+    [AC_DEFINE(fstat64, fstat, [64-bit operations are the same as 32-bit])
+     AC_DEFINE(lstat64, lstat, [64-bit operations are the same as 32-bit])
+     AC_DEFINE(stat64, stat, [64-bit operations are the same as 32-bit])])
 
 dnl Store the compile flags prior to testing the presence.
 
diff --git a/src/string2stat.c b/src/string2stat.c
index 5572632..2045828 100644
--- a/src/string2stat.c
+++ b/src/string2stat.c
@@ -20,6 +20,8 @@
 #include <string.h>
 #include <sys/stat.h>
 
+#include "debug_level.h"
+
 #ifdef WIN32
 #	include "dcap_unix2win.h"
 #endif /* WIN32 */
-- 
2.29.2

